<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TaskMatrix Test</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: system-ui, sans-serif;
      background: linear-gradient(135deg, #f8fafc, #dbeafe);
      min-height: 100vh;
      padding: 20px;
    }
    .container { max-width: 1200px; margin: 0 auto; }
    .auth-box {
      max-width: 400px;
      margin: 100px auto;
      background: white;
      padding: 40px;
      border-radius: 16px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    }
    h1 { margin-bottom: 10px; text-align: center; color: #3b82f6; }
    .subtitle { text-align: center; color: #6b7280; margin-bottom: 30px; font-size: 14px; }
    .form-group { margin-bottom: 20px; }
    label { display: block; margin-bottom: 8px; font-weight: 600; font-size: 14px; }
    input {
      width: 100%;
      padding: 12px;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      font-size: 16px;
    }
    input:focus { outline: none; border-color: #3b82f6; }
    button {
      width: 100%;
      padding: 12px;
      background: #3b82f6;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
    }
    button:hover { background: #2563eb; }
    button:disabled { opacity: 0.5; cursor: not-allowed; }
    .link { text-align: center; margin-top: 20px; font-size: 14px; color: #6b7280; }
    .link span { color: #3b82f6; cursor: pointer; font-weight: 600; }
    .message {
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 20px;
      font-size: 14px;
      display: none;
    }
    .error { background: #fef2f2; color: #ef4444; }
    .success { background: #dcfce7; color: #16a34a; }
    .app {
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      display: none;
    }
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 2px solid #e5e7eb;
    }
    .status { color: #16a34a; font-size: 14px; }
    .btn-logout {
      padding: 8px 16px;
      background: #ef4444;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
    }
    .quadrant {
      padding: 20px;
      border-radius: 8px;
      min-height: 200px;
    }
    .quadrant.red { background: #fef2f2; border: 2px solid #fca5a5; }
    .quadrant.blue { background: #eff6ff; border: 2px solid #93c5fd; }
    .quadrant.yellow { background: #fefce8; border: 2px solid #fde047; }
    .quadrant.gray { background: #f9fafb; border: 2px solid #d1d5db; }
    .quadrant h3 { margin-bottom: 15px; }
    .task {
      background: white;
      padding: 10px;
      margin-bottom: 8px;
      border-radius: 6px;
      border-left: 4px solid #3b82f6;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .task button {
      width: auto;
      padding: 4px 8px;
      font-size: 12px;
      background: #ef4444;
    }
    .empty { text-align: center; color: #9ca3af; padding: 40px; }
  </style>
</head>
<body>
  <div id="auth-view">
    <div class="auth-box">
      <h1>üìä TaskMatrix</h1>
      <p class="subtitle">Organize your life with the Eisenhower Matrix</p>
      
      <div id="error-msg" class="message error"></div>
      <div id="success-msg" class="message success"></div>
      
      <form id="auth-form">
        <div class="form-group">
          <label>Email</label>
          <input type="email" id="email" placeholder="you@example.com" required>
        </div>
        <div class="form-group">
          <label>Password</label>
          <input type="password" id="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required minlength="6">
        </div>
        <button type="submit" id="auth-btn">Sign In</button>
      </form>
      
      <div class="link">
        <span id="toggle-text">Don't have an account?</span>
        <span id="toggle-link" onclick="toggleMode()">Sign Up</span>
      </div>
    </div>
  </div>

  <div id="app-view" class="container">
    <div class="app">
      <div class="header">
        <div>
          <h2>üìä TaskMatrix</h2>
          <p class="status" id="status">‚úì Connected</p>
          <p style="font-size: 14px; color: #6b7280; margin-top: 5px;">
            Welcome, <span id="user-email"></span>
          </p>
        </div>
        <button class="btn-logout" onclick="logout()">Sign Out</button>
      </div>
      
      <div class="grid">
        <div class="quadrant red">
          <h3>üî• Do First</h3>
          <div id="do-first"></div>
        </div>
        <div class="quadrant blue">
          <h3>üìÖ Schedule</h3>
          <div id="schedule"></div>
        </div>
        <div class="quadrant yellow">
          <h3>ü§ù Delegate</h3>
          <div id="delegate"></div>
        </div>
        <div class="quadrant gray">
          <h3>üóëÔ∏è Eliminate</h3>
          <div id="eliminate"></div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const SUPABASE_URL = 'https://afnpnivrlmckvwilspfh.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFmbnBuaXZybG1ja3Z3aWxzcGZoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMwNDY2MDMsImV4cCI6MjA3ODYyMjYwM30.0bFGplQcP4zL6D-3QJIivpY8J1SFwkOIm-p-7Vfsvqg';
    
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
    let user = null;
    let isSignUp = false;

    async function init() {
      const { data: { session } } = await supabase.auth.getSession();
      if (session) {
        user = session.user;
        showApp();
      } else {
        showAuth();
      }
    }

    function showAuth() {
      document.getElementById('auth-view').style.display = 'block';
      document.getElementById('app-view').style.display = 'none';
    }

    function showApp() {
      document.getElementById('auth-view').style.display = 'none';
      document.getElementById('app-view').style.display = 'block';
      document.getElementById('user-email').textContent = user.email;
      loadTasks();
    }

    function toggleMode() {
      isSignUp = !isSignUp;
      document.getElementById('auth-btn').textContent = isSignUp ? 'Sign Up' : 'Sign In';
      document.getElementById('toggle-text').textContent = isSignUp ? 'Already have an account?' : "Don't have an account?";
      hideMessages();
    }

    document.getElementById('auth-form').onsubmit = async (e) => {
      e.preventDefault();
      hideMessages();
      
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      const btn = document.getElementById('auth-btn');
      
      btn.disabled = true;
      btn.textContent = isSignUp ? 'Creating...' : 'Signing in...';
      
      try {
        if (isSignUp) {
          const { error } = await supabase.auth.signUp({ email, password });
          if (error) throw error;
          showSuccess('Account created! Check your email to verify.');
        } else {
          const { data, error } = await supabase.auth.signInWithPassword({ email, password });
          if (error) throw error;
          user = data.user;
          showApp();
        }
      } catch (error) {
        showError(error.message);
      } finally {
        btn.disabled = false;
        btn.textContent = isSignUp ? 'Sign Up' : 'Sign In';
      }
    };

    async function logout() {
      if (confirm('Sign out?')) {
        await supabase.auth.signOut();
        user = null;
        showAuth();
      }
    }

    async function loadTasks() {
      document.getElementById('status').textContent = '‚ü≥ Loading...';
      try {
        const { data, error } = await supabase
          .from('tasks')
          .select('*')
          .eq('user_id', user.id);
        
        if (error) throw error;
        
        document.getElementById('status').textContent = '‚úì Synced with Cloud';
        
        if (data && data.length > 0) {
          // Display tasks
          data.forEach(task => {
            const quad = getQuad(task.importance, task.urgency);
            const el = document.getElementById(quad);
            el.innerHTML += `<div class="task"><span>${task.title}</span></div>`;
          });
        } else {
          // Show empty state
          ['do-first', 'schedule', 'delegate', 'eliminate'].forEach(id => {
            document.getElementById(id).innerHTML = '<div class="empty">No tasks yet</div>';
          });
        }
      } catch (error) {
        console.error('Load error:', error);
        document.getElementById('status').textContent = '‚ö†Ô∏è Error loading';
      }
    }

    function getQuad(imp, urg) {
      if (urg >= 4 && imp >= 4) return 'do-first';
      if (urg < 4 && imp >= 4) return 'schedule';
      if (urg >= 4 && imp < 4) return 'delegate';
      return 'eliminate';
    }

    function showError(msg) {
      const el = document.getElementById('error-msg');
      el.textContent = msg;
      el.style.display = 'block';
    }

    function showSuccess(msg) {
      const el = document.getElementById('success-msg');
      el.textContent = msg;
      el.style.display = 'block';
    }

    function hideMessages() {
      document.getElementById('error-msg').style.display = 'none';
      document.getElementById('success-msg').style.display = 'none';
    }

    init();
  </script>
</body>
</html>
